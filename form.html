<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Central de Atenciones</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .nested { margin-left: 1.5rem; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
  <form id="pagoForm" class="w-full max-w-3xl bg-white shadow-md rounded-xl p-6 space-y-4">
    <h1 class="text-2xl font-semibold text-gray-800 mb-4 text-center">CENTRAL DE ATENCIONES</h1>

    <!-- Campo de DNI -->
    <div class="mb-4">
      <label for="dni" class="block text-gray-700 font-medium mb-1">DNI del trabajador</label>
      <input type="text" id="dni" name="dni" maxlength="8" placeholder="Ingrese DNI (8 dígitos)"
             class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" required>
    </div>

    <!-- Contenedor del formulario dinámico -->
    <div id="formContainer" class="space-y-2"></div>

    <div class="flex justify-end">
      <button type="submit" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Enviar
      </button>
    </div>
  </form>

  <pre id="output" class="w-full max-w-3xl bg-white mt-4 p-4 rounded shadow text-sm hidden"></pre>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const formSchema = {
        "Pago correcto": {},
        "Pago incorrecto": {
          children: {
            "Planillas/Configuración de Pago": {
              children: {
                "Destiempo/Reintegro": {},
                "Movilidad": {},
                "Horas extras": {},
                "Gratificación incompleta": {},
                "Vacaciones pago incompleto": {},
                "Activación de A.F": {},
                "Compensación de A.F por movilidad": {},
                "Falta la contraparte": {},
                "No amortizó sobregiro": {},
                "Rebote de abono": {},
                "Bonos": {
                  children: {
                    "Alimentos": {},
                    "Armas": {},
                    "Referido": {}
                  }
                },
                "Quincena incompleta": {},
                "Descuentos errados": {
                  children: {
                    "Retención 5ta categoría": {},
                    "Retención judicial": {},
                    "Préstamo": {}
                  }
                },
                "CTS": { input: "Detalle" },
                "Feriados": {
                  children: {
                    "Monto": {},
                    "Día": {}
                  }
                },
                "Bonificación": {
                  children: {
                    "Cargo": {},
                    "Unidad": {},
                    "Reemplazo puesto": {},
                    "Nocturna": {}
                  }
                }
              }
            },
            "Tareo/Vacaciones/Regularización": {
              children: {
                "Venta de descanso - No tareado": {},
                "Servicio y/o descanso - No tareado": {},
                "Venta de vacaciones - No tareado": {},
                "Goce vacacional - No tareado": {},
                "Bono descansero": {},
                "Feriado pulpo": {},
                "Activación de puesto": {},
                "HH.EE/Reenganche - No tareado": {},
                "DM's / Licencias - No tareado": {
                  children: {
                    "Paternidad": {},
                    "Fallecimiento": {},
                    "Subsidios": {},
                    "Sin goce": {},
                    "Con goce": {}
                  }
                }
              }
            }
          }
        },
        "Apoyo económico/Préstamo": {
          children: {
            "Aprobado": { input: "Monto aprobado" },
            "No aprobado": { input: "Motivo de no aprobación" }
          }
        },
        "Otros/Soporte": {
          children: {
            "Entrega de boletas": {},
            "Información de fecha de pago de liquidación": {},
            "Información de aplicativos": {},
            "Información de directorio telefónico": {},
            "Otras consultas": {},
            "Soporte planillas": {
              children: {
                "Cambio cuenta sueldo": {},
                "Traslado/cambio CTS": {},
                "Oncosalud": {},
                "Cambio/exoneración fondo pensionario": {},
                "Certificado baja Sunat": {},
                "Certificado renta 5ta categoría": {}
              }
            },
            "Soporte bienestar social": {
              children: {
                "Descanso médico/Licencias - No reportados": {},
                "Activación A.F": {}
              }
            },
            "Soporte tareo": {},
            "Soporte selección": {
              children: {
                "Bono referidos": {},
                "Licencia de armas": {},
                "Altas a desatiempo": {}
              }
            },
            "Soporte administración de personal": {
              children: {
                "Adendas": {},
                "Fecha renovación contrato": {}
              }
            },
            "Información de fechas de pago": {}
          }
        }
      };

      const makeId = (str) => "f_" + str.toLowerCase().replace(/[^a-z0-9]+/g, "_");

      function renderForm(schema, container) {
        Object.entries(schema).forEach(([key, value]) => {
          const wrapper = document.createElement("div");
          wrapper.className = "mb-2";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = makeId(key);
          checkbox.className = "mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded";

          const label = document.createElement("label");
          label.textContent = key;
          label.htmlFor = checkbox.id;
          label.className = "text-gray-700 font-medium cursor-pointer";

          wrapper.appendChild(checkbox);
          wrapper.appendChild(label);

          const nested = document.createElement("div");
          nested.className = "nested ml-4 hidden mt-2 pl-4 border-l border-gray-200";
          wrapper.appendChild(nested);

          if (value.input) {
            const input = document.createElement("input");
            input.type = "text";
            input.placeholder = value.input;
            input.className = "mt-1 p-2 border rounded w-full";
            nested.appendChild(input);
          }

          if (value.children) renderForm(value.children, nested);

          checkbox.addEventListener("change", () => {
            nested.classList.toggle("hidden", !checkbox.checked);
            if (!checkbox.checked) {
              nested.querySelectorAll("input").forEach((i) => {
                if (i.type === "checkbox") i.checked = false;
                if (i.type === "text") i.value = "";
              });
            }
          });

          container.appendChild(wrapper);
        });
      }

      function collectData(schema) {
        const result = {};
        Object.entries(schema).forEach(([key, value]) => {
          const checkbox = document.getElementById(makeId(key));
          if (checkbox && checkbox.checked) {
            const node = {};
            const nested = checkbox.parentElement.querySelector(".nested");
            if (nested) {
              const input = nested.querySelector(":scope > input[type='text']");
              if (input && input.value) node["valor"] = input.value;
            }
            if (value.children) Object.assign(node, collectData(value.children));
            result[key] = node;
          }
        });
        return result;
      }

      const formContainer = document.getElementById("formContainer");
      renderForm(formSchema, formContainer);

      document.getElementById("pagoForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const dni = document.getElementById("dni").value;
        const data = collectData(formSchema);
        const fullData = { dni, ...data };
        const output = document.getElementById("output");
        output.textContent = JSON.stringify(fullData, null, 2);
        output.classList.remove("hidden");
        console.log(fullData);
      });
    });
  </script>
</body>
</html>
